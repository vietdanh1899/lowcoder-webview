import{gm as re,gn as se,go as le,gp as ce,a4 as de,gq as me,bD as ue,bS as M,bz as pe,bs as he,c7 as fe,d,eW as ge,as as V,k as P,bG as f,bH as S,aj as m,a0 as h,bN as g,cx as ye,bI as be,eb as ve,f1 as Se,bJ as we,cy as xe,bL as Ce,dZ as X,eV as B,fg as R,gr as De,gs as $e,gt as Ne,M as Pe,eu as Ie,b2 as Oe,gu as Ve,gv as ze,eS as Ee,a3 as Me,ai as je,gw as K,gx as Te,gy as ke,gz as qe,F as W,gA as j,gB as Fe,gC as _e,gD as Ae,gE as Ge,B as Le,gF as He,gG as Xe,gH as Be}from"./index-CyMr76_m.js";import{CreateForm as Ke}from"./7fee7d1f-DlIKriQK.js";import{ContainerCompBuilder as We}from"./f9eaeade-BI-7JMdq.js";import{TriContainer as Ze}from"./07fd6f2d-4kX8EOwO.js";import"./76dbc7e2-BQjiWbFV.js";import"./5bf5eda6-DQa3j8Ha.js";import"./f52ee168-CndtDUrJ.js";import"./de2e4e92-CLGZnZd1.js";import"./bf2ffa97-CE4h1tFV.js";import"./90e6d3f7-0GLayY-W.js";import"./3eacf14a-jaqUEiFu.js";import"./a353f3e4-DD4QcEPO.js";import"./a6ed71f1-CFlnijMj.js";var k={},I={},Z;function Je(){if(Z)return I;Z=1;var e=R.default;Object.defineProperty(I,"__esModule",{value:!0}),I.default=n;var i=e(De());function n(o,s){var c=(0,i.default)({},o);return Array.isArray(s)&&s.forEach(function(l){delete c[l]}),c}return I}const Qe=Le(He);var v={},J;function Re(){if(J)return v;J=1,Object.defineProperty(v,"__esModule",{value:!0}),v.prepareComponentToken=v.default=void 0;var e=qe,i=$e(),n=Ne();const o=new e.Keyframes("antSpinMove",{to:{opacity:1}}),s=new e.Keyframes("antRotate",{to:{transform:"rotate(405deg)"}}),c=t=>{const{componentCls:a,calc:r}=t;return{[`${a}`]:Object.assign(Object.assign({},(0,i.resetComponent)(t)),{position:"absolute",display:"none",color:t.colorPrimary,fontSize:0,textAlign:"center",verticalAlign:"middle",opacity:0,transition:`transform ${t.motionDurationSlow} ${t.motionEaseInOutCirc}`,"&-spinning":{position:"static",display:"inline-block",opacity:1},[`${a}-text`]:{fontSize:t.fontSize,paddingTop:r(r(t.dotSize).sub(t.fontSize)).div(2).add(2).equal()},"&-fullscreen":{position:"fixed",width:"100vw",height:"100vh",backgroundColor:t.colorBgMask,zIndex:t.zIndexPopupBase,inset:0,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",opacity:0,visibility:"hidden",transition:`all ${t.motionDurationMid}`,"&-show":{opacity:1,visibility:"visible"},[`${a}-dot ${a}-dot-item`]:{backgroundColor:t.colorWhite},[`${a}-text`]:{color:t.colorTextLightSolid}},"&-nested-loading":{position:"relative",[`> div > ${a}`]:{position:"absolute",top:0,insetInlineStart:0,zIndex:4,display:"block",width:"100%",height:"100%",maxHeight:t.contentHeight,[`${a}-dot`]:{position:"absolute",top:"50%",insetInlineStart:"50%",margin:r(t.dotSize).mul(-1).div(2).equal()},[`${a}-text`]:{position:"absolute",top:"50%",width:"100%",textShadow:`0 1px 2px ${t.colorBgContainer}`},[`&${a}-show-text ${a}-dot`]:{marginTop:r(t.dotSize).div(2).mul(-1).sub(10).equal()},"&-sm":{[`${a}-dot`]:{margin:r(t.dotSizeSM).mul(-1).div(2).equal()},[`${a}-text`]:{paddingTop:r(r(t.dotSizeSM).sub(t.fontSize)).div(2).add(2).equal()},[`&${a}-show-text ${a}-dot`]:{marginTop:r(t.dotSizeSM).div(2).mul(-1).sub(10).equal()}},"&-lg":{[`${a}-dot`]:{margin:r(t.dotSizeLG).mul(-1).div(2).equal()},[`${a}-text`]:{paddingTop:r(r(t.dotSizeLG).sub(t.fontSize)).div(2).add(2).equal()},[`&${a}-show-text ${a}-dot`]:{marginTop:r(t.dotSizeLG).div(2).mul(-1).sub(10).equal()}}},[`${a}-container`]:{position:"relative",transition:`opacity ${t.motionDurationSlow}`,"&::after":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:10,width:"100%",height:"100%",background:t.colorBgContainer,opacity:0,transition:`all ${t.motionDurationSlow}`,content:'""',pointerEvents:"none"}},[`${a}-blur`]:{clear:"both",opacity:.5,userSelect:"none",pointerEvents:"none","&::after":{opacity:.4,pointerEvents:"auto"}}},"&-tip":{color:t.spinDotDefault},[`${a}-dot`]:{position:"relative",display:"inline-block",fontSize:t.dotSize,width:"1em",height:"1em","&-item":{position:"absolute",display:"block",width:r(t.dotSize).sub(r(t.marginXXS).div(2)).div(2).equal(),height:r(t.dotSize).sub(r(t.marginXXS).div(2)).div(2).equal(),backgroundColor:t.colorPrimary,borderRadius:"100%",transform:"scale(0.75)",transformOrigin:"50% 50%",opacity:.3,animationName:o,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"alternate","&:nth-child(1)":{top:0,insetInlineStart:0,animationDelay:"0s"},"&:nth-child(2)":{top:0,insetInlineEnd:0,animationDelay:"0.4s"},"&:nth-child(3)":{insetInlineEnd:0,bottom:0,animationDelay:"0.8s"},"&:nth-child(4)":{bottom:0,insetInlineStart:0,animationDelay:"1.2s"}},"&-spin":{transform:"rotate(45deg)",animationName:s,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&-sm ${a}-dot`]:{fontSize:t.dotSizeSM,i:{width:r(r(t.dotSizeSM).sub(r(t.marginXXS).div(2))).div(2).equal(),height:r(r(t.dotSizeSM).sub(r(t.marginXXS).div(2))).div(2).equal()}},[`&-lg ${a}-dot`]:{fontSize:t.dotSizeLG,i:{width:r(r(t.dotSizeLG).sub(t.marginXXS)).div(2).equal(),height:r(r(t.dotSizeLG).sub(t.marginXXS)).div(2).equal()}},[`&${a}-show-text ${a}-text`]:{display:"block"}})}},l=t=>{const{controlHeightLG:a,controlHeight:r}=t;return{contentHeight:400,dotSize:a/2,dotSizeSM:a*.35,dotSizeLG:r}};return v.prepareComponentToken=l,v.default=(0,n.genStyleHooks)("Spin",t=>{const a=(0,n.mergeToken)(t,{spinDotDefault:t.colorTextDescription});return[c(a)]},l),v}var q=R;Object.defineProperty(k,"__esModule",{value:!0});var U=k.default=void 0,p=tt(Pe),w=q(re),Ue=q(Je()),Ye=Qe,O=se();le();var Q=ce(),et=q(Re());function Y(e){if(typeof WeakMap!="function")return null;var i=new WeakMap,n=new WeakMap;return(Y=function(o){return o?n:i})(e)}function tt(e,i){if(e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var n=Y(i);if(n&&n.has(e))return n.get(e);var o={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if(c!=="default"&&Object.prototype.hasOwnProperty.call(e,c)){var l=s?Object.getOwnPropertyDescriptor(e,c):null;l&&(l.get||l.set)?Object.defineProperty(o,c,l):o[c]=e[c]}return o.default=e,n&&n.set(e,o),o}var it=function(e,i){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&i.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,o=Object.getOwnPropertySymbols(e);s<o.length;s++)i.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]]);return n};let z=null;function nt(e,i){const{indicator:n}=i,o=`${e}-dot`;return n===null?null:(0,O.isValidElement)(n)?(0,O.cloneElement)(n,{className:(0,w.default)(n.props.className,o)}):(0,O.isValidElement)(z)?(0,O.cloneElement)(z,{className:(0,w.default)(z.props.className,o)}):p.createElement("span",{className:(0,w.default)(o,`${e}-dot-spin`)},p.createElement("i",{className:`${e}-dot-item`,key:1}),p.createElement("i",{className:`${e}-dot-item`,key:2}),p.createElement("i",{className:`${e}-dot-item`,key:3}),p.createElement("i",{className:`${e}-dot-item`,key:4}))}function ot(e,i){return!!e&&!!i&&!isNaN(Number(i))}const ee=e=>{const{prefixCls:i,spinning:n=!0,delay:o=0,className:s,rootClassName:c,size:l="default",tip:t,wrapperClassName:a,style:r,children:y,fullscreen:b}=e,C=it(e,["prefixCls","spinning","delay","className","rootClassName","size","tip","wrapperClassName","style","children","fullscreen"]),{getPrefixCls:D}=p.useContext(Q.ConfigContext),u=D("spin",i),[te,F,_]=(0,et.default)(u),[x,A]=p.useState(()=>n&&!ot(n,o));p.useEffect(()=>{if(n){const N=(0,Ye.debounce)(o,()=>{A(!0)});return N(),()=>{var E;(E=N==null?void 0:N.cancel)===null||E===void 0||E.call(N)}}A(!1)},[o,n]);const G=p.useMemo(()=>typeof y<"u"&&!b,[y,b]),{direction:ie,spin:$}=p.useContext(Q.ConfigContext),ne=(0,w.default)(u,$==null?void 0:$.className,{[`${u}-sm`]:l==="small",[`${u}-lg`]:l==="large",[`${u}-spinning`]:x,[`${u}-show-text`]:!!t,[`${u}-fullscreen`]:b,[`${u}-fullscreen-show`]:b&&x,[`${u}-rtl`]:ie==="rtl"},s,c,F,_),oe=(0,w.default)(`${u}-container`,{[`${u}-blur`]:x}),L=(0,Ue.default)(C,["indicator"]),ae=Object.assign(Object.assign({},$==null?void 0:$.style),r),H=p.createElement("div",Object.assign({},L,{style:ae,className:ne,"aria-live":"polite","aria-busy":x}),nt(u,e),t&&(G||b)?p.createElement("div",{className:`${u}-text`},t):null);return te(G?p.createElement("div",Object.assign({},L,{className:(0,w.default)(`${u}-nested-loading`,a,F,_)}),x&&p.createElement("div",{key:"loading"},H),p.createElement("div",{className:oe,key:"container"},y)):H)};ee.setDefaultIndicator=e=>{z=e};U=k.default=ee;const at=de.div`
  height: 100%;
  .ant-spin-nested-loading {
    height: 100%;
    .ant-spin-container {
      height: 100%;
    }
  }
`,rt=[Ie],st={initialData:me,resetAfterSubmit:ue,disabled:M,disableSubmit:M,loading:M,onEvent:pe(rt),animationStyle:he(fe)};function lt(e,i){const{dispatch:n,layout:o,positionParams:s}=e.container.body[0].children.view.getView();let c=0;const l=i.map(({column:t,compName:a})=>{const r={i:"",h:Xe(t.comp.type).h,w:s.cols,x:0,y:c};return c=c+r.h,{item:{compType:t.comp.type,name:a,comp:{...t.comp.compInitData,formDataKey:t.name,label:{text:t.label},required:t.required}},layoutItem:r}});n(j(Be(o,l)))}function ct(e){return{name:"submit",handler:{compType:"executeQuery",comp:{queryName:e}}}}function dt(e,i,n,o){const{dispatch:s}=i,c=n.getNameGenerator(),l=e.columns.map(D=>{const u=c.genItemName("form"+W.upperFirst(D.comp.type));return{column:D,compName:u}});lt(i,l);const t=e.tableName,a=t.substring(t.lastIndexOf(".")+1),r=o+"SubmitTo"+a.split("_").map(W.upperFirst).join(""),y=c.genItemName(r);s(j(Fe("onEvent",_e(ct(y)))));const b=e.dataSourceTypeConfig.getQueryInitData(o,t,l),C=n.getQueriesComp();return C.dispatch(j(C.pushAction({...b,id:Ae(),name:y,datasourceId:e.dataSourceId,triggerType:"manual",notification:{showSuccess:!0,showFail:!0}}))),n.setSelectedBottomRes(y,Ge.Query),""}const mt=e=>{const i=h.useContext(g),n=h.useContext(Oe);return V(Ve,{children:[m("formComp.containerPlaceholder"),d("br",{}),d(Ke,{onCreate:o=>Promise.resolve(dt(o,e,i,n))})]})},ut=d(ze,{spin:!0}),pt=function(){return new We(st,(e,i)=>d(ge.Provider,{value:e.disabled,children:d(at,{children:d(U,{indicator:ut,spinning:e.loading,style:{height:"100%"},children:d(Ze,{...e,hintPlaceholder:d(mt,{...e,dispatch:i})})})})})).setPropertyViewFn(e=>V(P,{children:[d(f,{name:S.basic,children:e.resetAfterSubmit.propertyView({label:m("formComp.resetAfterSubmit")})}),(h.useContext(g).editorModeStatus==="logic"||h.useContext(g).editorModeStatus==="both")&&d(P,{children:V(f,{name:S.interaction,children:[e.onEvent.getPropertyView(),ye(e),e.disableSubmit.propertyView({label:m("formComp.disableSubmit")}),be(e),ve(e)]})}),(h.useContext(g).editorModeStatus==="layout"||h.useContext(g).editorModeStatus==="both")&&d(P,{children:d(f,{name:S.layout,children:e.container.getPropertyView()})}),(h.useContext(g).editorModeStatus==="logic"||h.useContext(g).editorModeStatus==="both")&&d(f,{name:S.advanced,children:e.initialData.propertyView({label:m("formComp.initialData")})}),(h.useContext(g).editorModeStatus==="layout"||h.useContext(g).editorModeStatus==="both")&&V(P,{children:[d(f,{name:S.style,children:e.container.stylePropertyView()}),d(f,{name:S.animationStyle,hasTooltip:!0,children:e.animationStyle.getPropertyView()}),e.container.children.showHeader.getView()&&d(f,{name:"Header Style",children:e.container.headerStylePropertyView()}),e.container.children.showBody.getView()&&d(f,{name:"Body Style",children:e.container.bodyStylePropertyView()}),e.container.children.showFooter.getView()&&d(f,{name:"Footer Style",children:e.container.footerStylePropertyView()})]})]})).build()}();let T=class extends pt{onEventPropertyView(e){return this.children.onEvent.propertyView({title:e})}traverseFormItems(e){return Ee(this.getCompTree(),i=>i.children.comp.children.formDataKey?e(i):!0)}validateFormItems(){return this.traverseFormItems(e=>{var i;return!((i=e.children.comp.exposingValues)!=null&&i.invalid)})}runMethodOfItems(...e){const i=[];return this.traverseFormItems(n=>{var o;const s=n.children.comp.exposingMethods();for(const l of e){const t=(o=s[l.name])==null?void 0:o.func;if(t){const a=l.getParams?l.getParams(n):[];if(a!==void 0)return i.push(Promise.resolve(t(...a))),!0}}const c=n.children.compType.getView();return Me.warn(m("form")+c+m("formComp.notSupportMethod")+e.map(l=>l.name)),!0}),Promise.all(i).then(()=>{})}setData(e,i){const n={...i??this.children.initialData.getView(),...e};return this.runMethodOfItems({name:"setValue",getParams:o=>{var s;const c=((s=o.children.comp.children.formDataKey)==null?void 0:s.getView())||o.children.name.getView(),l=n[c];return l!==void 0?[l]:void 0}},{name:"resetValue"},{name:"clearValue"})}reset(){return this.setData({})}submit(){return this.disableSubmit()?Promise.reject("disableSubmit"):this.validateFormItems()?this.children.onEvent.getView()("submit").then(()=>this.children.resetAfterSubmit.getView()?this.reset():Promise.resolve()):(je.error(m("formComp.notValidForm")),Promise.reject("formComp.notValidForm"))}disableSubmit(){return this.children.disabled.getView()||this.children.disableSubmit.getView()}reduce(e){switch(e.type){case K.UPDATE_NODES_V2:{const i=super.reduce(e);return i.children.initialData!==this.children.initialData&&setTimeout(()=>{this.dispatch(ke({type:"setData",initialData:e.value.initialData.value||{}},!1))}),i}case K.CUSTOM:if(Te(e,"setData"))return this.setData({},e.value.initialData),this}return super.reduce(e)}};T=Se(T,[{method:{name:"submit",description:m("export.submitDesc"),params:[]},execute:(e,i)=>e.submit()},{method:{name:"reset",description:m("formComp.resetDesc"),params:[]},execute:(e,i)=>e.reset()},{method:{name:"clear",description:m("formComp.clearDesc"),params:[]},execute:(e,i)=>e.runMethodOfItems({name:"clearValue"})},{method:{name:"setData",description:m("formComp.setDataDesc"),params:[{name:"data",type:"JSON"}]},execute:(e,i)=>{if(i.length!==1)return Promise.reject(m("formComp.valuesLengthError"));const n=i[0];return typeof n!="object"||n===null||Array.isArray(n)?Promise.reject(m("formComp.valueTypeError")):e.setData(n)}}]);const Pt=we(T,[...xe,new Ce("loading",m("formComp.loadingDesc")),X({name:"data",desc:m("formComp.dataDesc"),depKeys:["container"],func:e=>{const i={};return Object.entries(e.container).forEach(([n,o])=>{const s=o;s!=null&&s.hasOwnProperty("formDataKey")&&(i[s.formDataKey||n]=s.value)}),i}}),X({name:"invalid",desc:m("export.invalidDesc"),depKeys:["container"],func:e=>{for(const[,i]of Object.entries(e.container)){const n=i;if(n!=null&&n.hasOwnProperty("formDataKey")&&n.invalid)return!0}return!1}})]);function It(e,i){return{container:{header:B([{item:{compType:"text",name:i.genItemName("formTitle"),comp:{text:"### "+m("formComp.formTitle")}},layoutItem:{i:"",h:5,w:24,x:0,y:0}}]),footer:B([{item:{compType:"button",name:i.genItemName("formButton"),comp:{text:m("button.submit"),type:"submit",form:e}},layoutItem:{i:"",h:5,w:10,x:14,y:0}}]),showHeader:!0,showFooter:!0}}}export{Pt as FormComp,It as defaultFormData};
