import{dK as p,er as le,dO as I,bw as k,aj as a,bT as D,bD as z,bz as ie,bs as B,es as re,c7 as se,et as S,d7 as me,bF as de,d as n,as as i,k as L,bG as d,bH as c,a0 as l,bN as g,bI as ce,bJ as ue,bL as w,bK as pe,bM as ve,eu as he,ev as be,ew as ye,cb as ge,cc as we,ex as E,ey as fe,ez as xe,c1 as Ce,eA as J,c2 as Ae,cX as Ie,F as u,br as ke,eB as De}from"./index-CyMr76_m.js";import{commentDate as Se,convertCommentData as Le,checkUserInfoData as Ee,checkMentionListData as Te,CommentDataTooltip as Ve,CommentUserDataTooltip as Ne}from"./82c98cbd-2hPKRSlM.js";p.extend(le);const Me=[ve,he,be,ye],He={value:I(Le,Se),title:k(D,a("comment.titledDefaultValue")),placeholder:k(D,a("comment.placeholder")),buttonText:k(D,a("comment.buttonText")),sendCommentAble:z.DEFAULT_TRUE,deleteAble:z,userInfo:I(Ee,{name:"{{currentUser.name}}",email:"{{currentUser.email}}"}),mentionList:I(Te,{"@":["Li Lei","Han Meimei"],"#":["123","456","789"]}),onEvent:ie(Me),style:B(re),animationStyle:B(se),commentList:S("commentList",[]),deletedItem:S("deletedItem",[]),submitedItem:S("submitedItem",[]),mentionName:me("")},Ke=t=>{const v=l.useRef(null),{value:V,dispatch:O,style:s,title:f,sendCommentAble:j,buttonText:G,onEvent:Pe,mentionList:b,userInfo:X,placeholder:_,deleteAble:q,animationStyle:y}=t,[N,Z]=l.useState([]),[r,x]=l.useState([]),[Q,W]=l.useState("@"),[C,M]=l.useState(""),A=e=>{Z(u.merge(e,{"@":u.union(u.concat(e["@"],u.map(r,(o,m)=>{var h;return(h=o==null?void 0:o.user)==null?void 0:h.name})))}))};l.useEffect(()=>{x(V)},[V]),l.useEffect(()=>{A(b)},[b]),l.useEffect(()=>{t.commentList.onChange(r),A(b),setTimeout(()=>{v.current&&(v.current.scrollTop=999999)},50)},[r]);const ee=(e,o)=>{W(o)},te=e=>{var o,m,h,K,P,Y,U,$,F,R;return i(ke,{onClick:()=>t.onEvent("click"),style:{backgroundColor:(o=e==null?void 0:e.user)!=null&&o.avatar?"":De(((m=e==null?void 0:e.user)==null?void 0:m.displayName)===void 0?(h=e==null?void 0:e.user)==null?void 0:h.name:(K=e==null?void 0:e.user)==null?void 0:K.displayName)[1],verticalAlign:"middle"},src:(P=e==null?void 0:e.user)==null?void 0:P.avatar,children:[" ",(Y=e==null?void 0:e.user)!=null&&Y.displayName?(U=e==null?void 0:e.user)==null?void 0:U.displayName:/^([\u4e00-\u9fa5]{2,4})$/gi.test(($=e==null?void 0:e.user)==null?void 0:$.name)?(F=e==null?void 0:e.user)==null?void 0:F.name.slice(-2):(R=e==null?void 0:e.user)==null?void 0:R.name[0]]})},ne=e=>{M(e)},H=()=>{let e={user:X,value:C,createdAt:p().format()};t.submitedItem.onChange(e),x(u.concat(r,[e])),M(""),A(b),t.onEvent("submit")},ae=e=>{let o=u.cloneDeep(r);t.deletedItem.onChange(o.splice(e,1)),x(o),t.onEvent("delete")},oe=e=>{e.shiftKey&&(e.preventDefault(),H())};return n("div",{style:{margin:s.margin??"3px",padding:s.padding??"3px",width:ge(s.margin??"3px"),height:we(s.margin??"3px"),background:s.background,borderRadius:s.radius,animation:y.animation,animationDelay:y.animationDelay,animationDuration:y.animationDuration,animationIterationCount:y.animationIterationCount},children:i("div",{style:{overflow:"auto",overflowX:"hidden",height:"100%"},ref:v,children:[n(E,{header:f!==""?n("div",{style:{position:"sticky",top:0,background:s.background},children:r.length>1?f.replaceAll("%d",r.length.toString()).replace("comment","comments"):f.replaceAll("%d",r.length.toString())}):"",size:"small",children:n(fe,{data:r,itemKey:"createdAt",children:(e,o)=>{var m;return n(E.Item,{actions:q?[n(xe,{style:{color:"#c32230"},onClick:()=>ae(o)})]:void 0,children:n(E.Item.Meta,{avatar:te(e),title:i("div",{onClick:()=>t.onEvent("click"),children:[n("a",{children:(m=e==null?void 0:e.user)==null?void 0:m.name}),n(Ce,{title:p(e==null?void 0:e.createdAt).isValid()?p(e==null?void 0:e.createdAt).format("YYYY/M/D HH:mm:ss"):a("comment.dateErr"),placement:"bottom",children:n("span",{style:{paddingLeft:"5px",color:"#999",fontSize:"11px"},children:p(e==null?void 0:e.createdAt).isValid()?p(e==null?void 0:e.createdAt).fromNow():a("comment.dateErr")})})]}),description:n("span",{children:e==null?void 0:e.value})})},e==null?void 0:e.createdAt)}})}),j?i("div",{style:{position:"sticky",bottom:0,background:s.background},children:[n(J,{style:{width:"100%",height:50},onSearch:ee,prefix:Object.keys(N),onChange:ne,onSelect:e=>{O(Ae("mentionName",e==null?void 0:e.value,!1)),t.onEvent("mention")},value:C,rows:2,onPressEnter:oe,placeholder:_,children:(N[Q]||[]).map((e,o)=>n(J.Option,{value:e,children:e},o.toString()))}),n(Ie,{type:"primary",style:{width:"100%",marginTop:"10px"},onClick:H,disabled:C==="",children:G})]}):""]})})};let T=function(){return new de(He,(t,v)=>n(Ke,{...t,dispatch:v})).setPropertyViewFn(t=>i(L,{children:[n(d,{name:c.basic,children:t.title.propertyView({label:a("comment.title")})}),(l.useContext(g).editorModeStatus==="logic"||l.useContext(g).editorModeStatus==="both")&&i(L,{children:[i(d,{name:c.data,children:[t.value.propertyView({label:a("comment.value"),tooltip:Ve,placeholder:"[]"}),t.userInfo.propertyView({label:a("comment.userInfo"),tooltip:Ne}),t.mentionList.propertyView({label:a("comment.mentionList"),tooltip:a("comment.mentionListDec")})]}),i(d,{name:c.interaction,children:[t.onEvent.getPropertyView(),ce(t),t.sendCommentAble.propertyView({label:a("comment.showSendButton")}),t.deleteAble.propertyView({label:a("comment.deleteAble")})]})]}),(l.useContext(g).editorModeStatus==="layout"||l.useContext(g).editorModeStatus==="both")&&i(L,{children:[i(d,{name:c.layout,children:[t.sendCommentAble.getView()&&t.buttonText.propertyView({label:a("comment.buttonTextDec")}),t.placeholder.propertyView({label:a("comment.placeholderDec")})]}),n(d,{name:c.style,children:t.style.getPropertyView()}),n(d,{name:c.animationStyle,hasTooltip:!0,children:t.animationStyle.getPropertyView()})]})]})).build()}();T=class extends T{autoHeight(){return!1}};const $e=ue(T,[new w("commentList",a("comment.commentList")),new w("deletedItem",a("comment.deletedItem")),new w("submitedItem",a("comment.submitedItem")),new w("mentionName",a("comment.submitedItem")),pe]);export{$e as CommentComp};
