import{t as E,g as K,s as U,f as _,a as j,O as S,b as H,c as M,d as F,e as k,C as q}from"./ddcbae00-C5tpClLZ.js";import{getPageSize as N}from"./890d69bf-DGU2Stkr.js";import{TableCompView as B}from"./f9d675ac-DkjyVGvq.js";import{nh as J,F as r,gA as V,fb as $,fc as G,ni as L,gw as b,gB as O,nj as Q,dv as g,dw as m,eU as w,ha as D,nk as Z,bJ as X,nl as u,aj as h,f0 as y,dZ as Y,bL as W,hc as ee,d as v,nm as te,hb as ae,nn as ie,no as ne,c2 as oe,f1 as se,a0 as le,bN as re}from"./index-CyMr76_m.js";import{getSelectedRowKeys as z}from"./8002df8f-3pwYLozv.js";import{compTablePropertyView as de}from"./34dff390-DJ6o0_Zp.js";import{TableInitComp as ce,RowColorComp as he,RowHeightComp as pe}from"./de153889-6kDJh68x.js";import"./aa7442af-9y-PcNP7.js";import"./7a2fe5b9-_-VMc9tG.js";import"./afec2121-C9tEEv6l.js";import"./bdca90af-Ey2_L0tV.js";import"./119198d1-DOPTi23L.js";import"./0a6b3cae-DX_83YlB.js";import"./bbcd8d34-UQLMzqWl.js";import"./73e0b0c0-cg4qSQqq.js";import"./3edfe717-MHa75G-T.js";import"./58f3786f-CAidjqLe.js";import"./a0462e8b-DZIRdcE2.js";import"./3b4688fc-D_wIQU04.js";import"./779f3b7b-amEsk8BD.js";import"./6273459c-DX34gMfV.js";import"./b6a2fc32-DwuV3HZx.js";import"./1cf690a1-I_QK1KnU.js";import"./78fe38f6-CDiAuiLE.js";import"./019144c6-D7yg04yX.js";import"./4a5e4036-B1Vv5Fk3.js";import"./528263cd-C4IHPG-V.js";import"./c9e82af5-CWpE2eMW.js";import"./a88cf471-CYUSef1b.js";import"./09457722-DqGlVZ8K.js";import"./0939bf73-t5w-dpUI.js";import"./c5075bb1-DugznTE7.js";import"./a5d57101-D6143Rva.js";import"./874205af-IDtItRsf.js";import"./3b333d0b-CW89wYop.js";import"./3806f8cf-BO9BPaTR.js";import"./cb943b07-CQ1qmLm2.js";import"./0e89e2a5-BZIvfWTd.js";import"./ad1328d1-BWLAZt-j.js";import"./75c4091e-vv9DScog.js";import"./56f904c9-ZQafhqnG.js";var ue=Object.defineProperty,ge=(e,a,t)=>a in e?ue(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,x=(e,a,t)=>(ge(e,typeof a!="symbol"?a+"":a,t),t);class A extends ce{constructor(){super(...arguments),x(this,"prevUnevaledValue"),x(this,"filterData",[]),x(this,"columnAggrData",{})}autoHeight(){return this.children.autoHeight.getView()}getTableAutoHeight(){return this.children.autoHeight.getView()}getSlotContainer(){return this.children.expansion.children.slot.getSelectedComp().getComp().children.container}findContainer(a){return this.getSlotContainer().findContainer(a)}getCompTree(){return this.getSlotContainer().getCompTree()}getPasteValue(a){return{...this.toJsonValue(),expansion:this.children.expansion.getPasteValue(a)}}realSimpleContainer(a){return this.getSlotContainer().realSimpleContainer(a)}downloadData(a){J({data:this.exposingValues.displayData,filename:a,fileType:"csv"})}refreshData(a,t){const i=this.children.data.exposingNode().dependNames().map(o=>o.split(".")[0]);if(r.isEmpty(i)){t(!0),setTimeout(()=>t(!1),200);return}const n=new Set(a);i.forEach(o=>{n.has(o)&&this.dispatch(V($(o,G({}))))})}getProps(){return L(r.omit(this.children,"style"))}shouldGenerateColumn(a,t){const i=a.children.columns.getView().map(l=>{const d=l.getView();return d.isCustom?"":d.dataIndex}).filter(l=>!!l),n=a.children.data.unevaledValue,o=this.prevUnevaledValue;if(!t)return this.prevUnevaledValue=n,!1;let s=!1;const c=Object.keys(t),p=a.children.dynamicColumn.getView();if((!o&&i.length===0||o&&n!==o||p||i.length<c.length&&i.every(l=>c.includes(l)))&&(s=!0),!s){const l=a.children.dataRowExample.getView(),d=i.length!==c.length||!r.isEqual(r.sortBy(i),r.sortBy(c));d&&!r.isEqual(l,t)?setTimeout(()=>{a.children.dataRowExample.dispatchChangeValueAction(t)}):!d&&l&&setTimeout(()=>{a.children.dataRowExample.dispatchChangeValueAction(null)})}return this.prevUnevaledValue=n,s}reduce(a){let t=super.reduce(a),i=!1;if(a.type===b.UPDATE_NODES_V2){const l=E(t.children.data.getView());if(i=t.children.data!==this.children.data&&!r.isEqual(this.children.data.getView(),t.children.data.getView()),i&&(t=t.setChild("rowColor",t.children.rowColor.reduce(he.changeContextDataAction({currentRow:l,currentIndex:0,currentOriginalIndex:0,columnTitle:l?Object.keys(l)[0]:void 0}))),t=t.setChild("rowHeight",t.children.rowHeight.reduce(pe.changeContextDataAction({currentRow:l,currentIndex:0,currentOriginalIndex:0,columnTitle:l?Object.keys(l)[0]:void 0})))),i){const d=t.shouldGenerateColumn(t,l),C=[];C.push(O("columns",t.children.columns.dataChangedAction({rowExample:l||{},doGeneColumn:d,dynamicColumn:t.children.dynamicColumn.getView(),data:t.children.data.getView()}))),d&&C.push(t.changeChildAction("dataRowExample",null)),setTimeout(()=>{C.forEach(T=>t.dispatch(V(T)))},0)}}let n=!1;const o=z(this.children.selection)[0]??"0",s=z(t.children.selection)[0]??"0",c=this.children.selection!==t.children.selection&&o!==s;(a.type===b.CUSTOM&&t.children.columns.getView().length!==this.children.columns.getView().length||c)&&(t=t.setChild("columns",t.children.columns.reduce(t.children.columns.setSelectionAction(s))),n=!0);let p=t.children.expansion.children.slot.getCachedParams(s);return(c||r.isNil(p)||i)&&(p=r.isNil(p)||i?K(t.filterData,s):void 0,t=t.setChild("expansion",t.children.expansion.reduce(t.children.expansion.setSelectionAction(s,p))),n=!0),a.type===b.UPDATE_NODES_V2&&n&&setTimeout(()=>t.dispatch(Q())),t}extraNode(){return{node:{sortedData:this.sortDataNode(),filterData:this.filterNode(),oriDisplayData:this.oriDisplayDataNode(),columnAggrData:this.columnAggrNode()},updateNodeFields:a=>({filterData:a.filterData,columnAggrData:a.columnAggrData})}}sortDataNode(){const a={data:this.children.data.exposingNode(),sort:this.children.sort.node(),dataIndexes:this.children.columns.getColumnsNode("dataIndex"),sortables:this.children.columns.getColumnsNode("sortable")},t=g(m(a),i=>{const{data:n,sort:o,dataIndexes:s,sortables:c}=i,p=r(s).mapValues((l,d)=>({sortable:!!c[d]})).mapKeys((l,d)=>s[d]).value();return U(n,p,o)});return w(this,"sortedDataNode",[t,a],(i,n)=>D(i[1],n[1]))[0]}filterNode(){const a={data:this.sortDataNode(),searchValue:this.children.searchText.node(),filter:this.children.toolbar.children.filter.node(),showFilter:this.children.toolbar.children.showFilter.node()};let t=this;const i=g(m(a),n=>{const{data:o,searchValue:s,filter:c,showFilter:p}=n,l=_(o,s.value,c,p.value);if(s.value&&o.length!==l.length){const d=t.children.onEvent.getView();setTimeout(()=>{d("dataSearch")})}return l.map(d=>j(d,d[S]))});return w(this,"filteredDataNode",[i,a],(n,o)=>D(n[1],o[1]))[0]}oriDisplayDataNode(){const a={data:this.filterNode(),showSizeChanger:this.children.pagination.children.showSizeChanger.node(),pageSize:this.children.pagination.children.pageSize.node(),pageSizeOptions:this.children.pagination.children.pageSizeOptions.node(),changablePageSize:this.children.pagination.children.changeablePageSize.node(),withParams:this.children.columns.withParamsNode(),dataIndexes:this.children.columns.getColumnsNode("dataIndex")},t=g(m(a),i=>{const n=r(i.dataIndexes).mapValues((s,c)=>({dataIndex:s,render:i.withParams[c]})).value(),o=N(i.showSizeChanger.value,i.pageSize.value,i.pageSizeOptions.value,i.changablePageSize);return H(i.data,o,Object.values(n))});return w(this,"oriDisplayDataNode",[t,a],(i,n)=>D(i[1],n[1]))[0]}displayDataIndexesNode(){const a={oriDisplayData:this.oriDisplayDataNode()},t=g(m(a),i=>r(i.oriDisplayData).map((n,o)=>[n[S],o]).fromPairs().value());return w(this,"displayDataIndexesNode",[t,a],(i,n)=>D(i[1],n[1]))[0]}changeSetNode(){const a={dataIndexes:this.children.columns.getColumnsNode("dataIndex"),renders:this.children.columns.getColumnsNode("render")},t=g(m(a),i=>{const n=r(i.dataIndexes).mapValues((s,c)=>i.renders[c]).mapKeys((s,c)=>i.dataIndexes[c]).value(),o={};return r.forEach(n,(s,c)=>{r.forEach(s[Z],(p,l)=>{const d=p.comp.comp.changeValue;r.isNil(d)||(o[l]||(o[l]={}),o[l][c]=d)})}),o});return w(this,"changeSetNode",[t,a],(i,n)=>D(i[1],n[1]))[0]}toUpdateRowsNode(){const a={oriDisplayData:this.oriDisplayDataNode(),indexes:this.displayDataIndexesNode(),changeSet:this.changeSetNode()},t=g(m(a),i=>r(i.changeSet).map((n,o)=>{const s=i.indexes[o];return{...r.omit(i.oriDisplayData[s],S),...n}}).value());return w(this,"toUpdateRowsNode",[t,a],(i,n)=>D(i[1],n[1]))[0]}columnAggrNode(){const a={oriDisplayData:this.oriDisplayDataNode(),withParams:this.children.columns.withParamsNode(),dataIndexes:this.children.columns.getColumnsNode("dataIndex")},t=g(m(a),i=>{const n=r(i.dataIndexes).mapValues((o,s)=>i.withParams[s]).mapKeys((o,s)=>i.dataIndexes[s]).value();return M(i.oriDisplayData,n)});return w(this,"columnAggrNode",[t,a],(i,n)=>D(i[1],n[1]))[0]}}let f=ee(A,e=>v(te,{hidden:e.children.hidden.getView(),children:v(B,{comp:e,onRefresh:(a,t)=>e.refreshData(a,t),onDownload:a=>e.downloadData(a)})}));const me=e=>a=>{const t=le.useContext(re).editorModeStatus;return v(e,{...a,editorModeStatus:t})};f=ae(f,e=>me(de)(e));f=ie(f,e=>a=>{if(e){if(ne(a)){const t=a.value.context;if(t&&!r.isNil(t.currentOriginalIndex)){const i=t.currentOriginalIndex+"";e(O("selection",oe("selectedRowKey",i,!1)))}}return e(a)}});function R(e,a){const t=(a+"").split("-");let i=e,n;for(let o of t){const s=Number(o);s>=0&&Array.isArray(i)&&s<i.length&&(n=i[s],i=n[q])}return n}function I(e,a){const t=a.split("-"),i=t[0];if(!i)return"";let n;return e.forEach((o,s)=>{o[S]===i&&(n=s)}),n&&t.length>1?[n,...t.slice(1)].join("-"):n}f=se(f,[{method:{name:"setFilter",description:"",params:[{name:"filter",type:"JSON"}]},execute:(e,a)=>{if(a[0]){const t=a[0],i=e.children.toolbar.children.filter.getView();e.children.toolbar.children.filter.dispatchChangeValueAction({...i,...t})}}},{method:{name:"setPage",description:"",params:[{name:"page",type:"number"}]},execute:(e,a)=>{const t=a[0];t&&t>0&&e.children.pagination.children.pageNo.dispatchChangeValueAction(t)}},{method:{name:"setSort",description:"",params:[{name:"sortColumn",type:"string"},{name:"sortDesc",type:"boolean"}]},execute:(e,a)=>{a[0]&&e.children.sort.dispatchChangeValueAction([{column:a[0],desc:a[1]}])}},{method:{name:"resetSelections",description:"",params:[]},execute:e=>{e.children.selection.children.selectedRowKey.dispatchChangeValueAction("0"),e.children.selection.children.selectedRowKeys.dispatchChangeValueAction([])}}]);const P=X(f,[new u("selectedRow",e=>({selectedRowKey:e.selection.children.selectedRowKey.node(),data:e.data.exposingNode()}),e=>{if(e.data)return R(e.data,e.selectedRowKey)},h("table.selectedRowDesc")),new u("selectedRows",e=>({selectedRowKeys:e.selection.children.selectedRowKeys.node(),data:e.data.exposingNode()}),e=>{if(e.data)return e.selectedRowKeys.flatMap(a=>{const t=R(e.data,a);return t===void 0?[]:[t]})},h("table.selectedRowsDesc")),new y("selectedIndex",e=>({oriDisplayData:e.oriDisplayDataNode(),selectedRowKey:e.children.selection.children.selectedRowKey.node()}),e=>I(e.oriDisplayData,e.selectedRowKey),h("table.selectedIndexDesc")),new y("selectedIndexes",e=>({oriDisplayData:e.oriDisplayDataNode(),selectedRowKeys:e.children.selection.children.selectedRowKeys.node()}),e=>e.selectedRowKeys.flatMap(a=>{const t=I(e.oriDisplayData,a);return t===void 0?[]:[t]}),h("table.selectedIndexDesc")),new y("changeSet",e=>({changeSet:e.changeSetNode()}),e=>e.changeSet,h("table.changeSetDesc")),new y("toUpdateRows",e=>({toUpdateRows:e.toUpdateRowsNode()}),e=>e.toUpdateRows,h("table.toUpdateRowsDesc")),new u("pageNo",e=>({pageNo:e.pagination.children.pageNo.exposingNode()}),e=>e.pageNo,h("table.pageNoDesc")),new u("pageSize",e=>({showSizeChanger:e.pagination.children.showSizeChanger.node(),changeablePageSize:e.pagination.children.changeablePageSize.node(),pageSize:e.pagination.children.pageSize.node(),pageSizeOptions:e.pagination.children.pageSizeOptions.node()}),e=>N(e.showSizeChanger.value,e.pageSize.value,e.pageSizeOptions.value,e.changeablePageSize),h("table.pageSizeDesc")),new u("sortColumn",e=>({sort:e.sort.node(),columns:e.columns.node()}),e=>{var a;const t=(a=e.sort[0])==null?void 0:a.column,i=Object.values(e.columns).find(n=>n.dataIndex===t);return i!=null&&i.isCustom&&i!=null&&i.title.value?i.title.value:t},h("table.sortColumnDesc")),Y({name:"sortDesc",desc:h("table.sortDesc"),depKeys:["sort"],func:e=>{var a;return((a=e.sort[0])==null?void 0:a.desc)||!1}}),new u("pageOffset",e=>({showSizeChanger:e.pagination.children.showSizeChanger.node(),changeablePageSize:e.pagination.children.changeablePageSize.node(),pageSize:e.pagination.children.pageSize.node(),pageSizeOptions:e.pagination.children.pageSizeOptions.node(),pageNo:e.pagination.children.pageNo.node()}),e=>N(e.showSizeChanger.value,e.pageSize.value,e.pageSizeOptions.value,e.changeablePageSize)*(e.pageNo-1),h("table.pageOffsetDesc")),new y("displayData",e=>({oriDisplayData:e.oriDisplayDataNode(),dataIndexes:e.children.columns.getColumnsNode("dataIndex"),titles:e.children.columns.getColumnsNode("title"),hides:e.children.columns.getColumnsNode("hide"),tempHides:e.children.columns.getColumnsNode("tempHide"),columnSetting:e.children.toolbar.children.columnSetting.node()}),e=>{const a=r(e.dataIndexes).pickBy((t,i)=>!F({hide:e.hides[i].value,tempHide:e.tempHides[i],enableColumnSetting:e.columnSetting.value})).mapValues((t,i)=>{var n;return(n=e.titles[i])==null?void 0:n.value}).mapKeys((t,i)=>e.dataIndexes[i]).value();return k(e.oriDisplayData,a)},h("table.displayDataDesc")),new u("filter",e=>({filter:e.toolbar.children.filter.node()}),e=>e.filter,h("table.filterDesc")),new u("selectedCell",e=>({selectedCell:e.selectedCell.node()}),e=>e.selectedCell,h("table.selectedCellDesc")),new W("data",h("table.dataDesc"))]),it=Object.freeze(Object.defineProperty({__proto__:null,TableComp:P,TableImplComp:A},Symbol.toStringTag,{value:"Module"})),nt=Object.freeze(Object.defineProperty({__proto__:null,TableComp:P},Symbol.toStringTag,{value:"Module"}));export{it as _,nt as a,P as r};
